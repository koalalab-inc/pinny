![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=
) ![Pinny](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAg0lEQVRIie2TQQ5AMBBFHzaugLO5BmezxpmQiFqwa6ozKSGNl3TVmf9n0l+ImREwwtO7RNILg00xjHFdJCHNEo2rDW7hNwg2qAQaRYhBLTCQ1FiUQAss+D/ZDDRnj4Urw77su7D0Hn9kDTnHZpOm6fWY/gYRGGSK2pUjqh0wPDPOF9kBFWsgFAFCv+sAAAAASUVORK5CYII=
) 
# Pinny

Hash-pining for your OSS dependencies

Pinny currently supports pinning Dockerfiles and Github Actions workflows.

## Installation
### Dockerhub image
WIP
```
WIP
```
### Executable binary
WIP
```
WIP
```

## Usage
### Github Actions
To pin your Github Actions workflows, run the following command in your repository root. This will transform all the workflows in your repository to use pinned versions of the actions. 
```
pinny actions pin
```
or if you are being rate limited by Github's API
```
GITHUB_TOKEN=<your_token> pinny actions pin
```
You can use the `--dry-run` flag to see what changes will be made before actually making them.

To learn more
```
pinny actions --help
```

### Dockerfiles
Pinny supports two workflows forpinning of dockerfiles.

#### 1. Pinning your files locally before you commit them
To pin your Dockerfile, run the following command in your repository root. This will look for file named `Dockerfile` in your repository root and will create a new file named `Dockerfile.pinned` with pinned versions of all the base images.
```
pinny docker pin
```
Use `--inplace` or `-i` flag to overwrite the original Dockerfile instead of creating a new file.
```
pinny docker pin --inplace
```
Use `--file` or `-f` flag to specify a different file name.
```
pinny docker pin --file Dockerfile.dev
```

#### 2. Generate and commit a lock file and pin your dockerfiles in CI
##### Generate a lock file
To generate a lock file, run the following command in your repository root. This will look for file named `Dockerfile` in your repository root and will create a file named `pinny-lock.json` with pinned versions of all the base images.
```
pinny docker lock
```
Use `--file` or `-f` flag to specify a different file name.
```
pinny docker lock --file Dockerfile.dev
```
To learn more
```
pinny docker lock --help
```
##### Tranform your dockerfiles in CI
Once you have committed the lock file, you can use the following command in your CI to transform your dockerfiles to use pinned versions of the base images.
```
pinny docker transform
```
Use `--file` or `-f` flag to specify a different file name.
```
pinny docker transform --file Dockerfile.dev
```
Use `--inplace` or `-i` flag to overwrite the original Dockerfile instead of creating a new file.
```
pinny docker transform --inplace
```
This command requires you have a file named pinny-lock.json.

To learn more
```
pinny docker tranform --help
```

## Example:
### Pinning Github Actions workflows
#### Before
```
name: Build
on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3.1.0

      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.17
```
#### After:
```
name: Build
on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # actions/checkout@v3.1.0

      - name: Set up Go
        uses: actions/setup-go@bfdd3570ce990073878bf10f6b2d79082de49492 # actions/setup-go@v2 | v2.2.0
        with:
          go-version: 1.17
```

### Pinning Dockerfiles
#### Before
```
FROM golang:alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/myapp .
EXPOSE 8080
CMD ["./myapp"]
```
#### After
```
# Pinned golang:alpine using pinny
FROM golang@sha256:110b07af87238fbdc5f1df52b00927cf58ce3de358eeeb1854f10a8b5e5e1411 AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

# Pinned alpine:latest using pinny on Tue, 28 Nov 2023 13:49:54 IST
FROM alpine@sha256:eece025e432126ce23f223450a0326fbebde39cdf496a85d8c016293fc851978 
WORKDIR /app
COPY --from=builder /app/myapp .
EXPOSE 8080
CMD ["./myapp"]
```





